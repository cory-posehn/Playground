Ally's changes are in here and here

Added some new stuff